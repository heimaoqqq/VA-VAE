# VA-VAEè®­ç»ƒæŒ‡å—ï¼šå¾®å¤šæ™®å‹’æ—¶é¢‘å›¾æ‰©æ•£æ¨¡å‹

## ğŸ¯ ç›®æ ‡
åŸºäºLightningDiTçš„VA-VAEæ¶æ„ï¼Œè®­ç»ƒé€‚ç”¨äºå¾®å¤šæ™®å‹’æ—¶é¢‘å›¾çš„æ‰©æ•£æ¨¡å‹ã€‚

## ğŸ“š VA-VAEè®­ç»ƒè¯´æ˜æ€»ç»“

### ğŸ”§ ç¯å¢ƒå®‰è£…

1. **åŸºç¡€ç¯å¢ƒ**ï¼š
   ```bash
   # å®‰è£…LightningDiTç¯å¢ƒ
   python install_dependencies.py
   ```

2. **VA-VAEä¸“ç”¨ä¾èµ–**ï¼š
   ```bash
   pip install -r LightningDiT/vavae/vavae_requirements.txt
   ```

3. **Taming-Transformers**ï¼ˆå¿…éœ€ï¼‰ï¼š
   ```bash
   git clone https://github.com/CompVis/taming-transformers.git
   cd taming-transformers
   pip install -e .
   
   # ä¿®å¤torch 2.xå…¼å®¹æ€§
   export FILE_PATH=./taming-transformers/taming/data/utils.py
   sed -i 's/from torch._six import string_classes/from six import string_types as string_classes/' "$FILE_PATH"
   ```

### ğŸ—ï¸ æ¨¡å‹æ¶æ„é…ç½®

#### æ ¸å¿ƒå‚æ•°è¯´æ˜ï¼š

| å‚æ•° | å«ä¹‰ | å¾®å¤šæ™®å‹’é€‚é…å»ºè®® |
|------|------|------------------|
| `embed_dim` | æ½œåœ¨ç©ºé—´ç»´åº¦ | 32 (æ ‡å‡†) / 16 (è½»é‡) / 64 (é«˜è´¨é‡) |
| `z_channels` | æ½œåœ¨ç‰¹å¾é€šé“æ•° | ä¸embed_dimç›¸åŒ |
| `resolution` | è¾“å…¥å›¾åƒåˆ†è¾¨ç‡ | 256 (é€‚åˆæ—¶é¢‘å›¾) |
| `in_channels` | è¾“å…¥é€šé“æ•° | **1 (ç°åº¦æ—¶é¢‘å›¾) æˆ– 3 (ä¼ªå½©è‰²)** |
| `out_ch` | è¾“å‡ºé€šé“æ•° | **ä¸in_channelsç›¸åŒ** |

#### è§†è§‰ç‰¹å¾å¯¹é½é€‰é¡¹ï¼š

1. **DINOv2** (`use_vf: dinov2`)ï¼š
   - æ›´å¼ºçš„è¯­ä¹‰ç†è§£
   - é€‚åˆå¤æ‚æ¨¡å¼è¯†åˆ«
   - **æ¨èç”¨äºå¾®å¤šæ™®å‹’ç‰¹å¾æå–**

2. **MAE** (`use_vf: mae`)ï¼š
   - æ›´å¥½çš„é‡å»ºèƒ½åŠ›
   - é€‚åˆç»†èŠ‚ä¿æŒ
   - é€‚åˆæ—¶é¢‘å›¾çº¹ç†ä¿æŒ

3. **æ— ç‰¹å¾å¯¹é½** (æ ‡å‡†LDM)ï¼š
   - æœ€è½»é‡çº§
   - è®­ç»ƒæœ€å¿«
   - åŸºç¡€ç‰ˆæœ¬

## ğŸ”¬ HuggingFaceé¢„è®­ç»ƒæ¨¡å‹å˜ä½“åˆ†æ

### VA-VAEæ¨¡å‹ (1.5GB+)
| æ¨¡å‹ | é…ç½® | ç‰¹å¾ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| `vavae-imagenet256-f16d32-dinov2-50ep.ckpt` | f16d32 + DINOv2 | è¯­ä¹‰å¯¹é½ | **å¾®å¤šæ™®å‹’æ¨¡å¼è¯†åˆ«** |
| `vavae-imagenet256-f16d32-mae-50ep.ckpt` | f16d32 + MAE | é‡å»ºä¼˜åŒ– | æ—¶é¢‘å›¾ç»†èŠ‚ä¿æŒ |
| `vavae-imagenet256-f16d64-dinov2-50ep.ckpt` | f16d64 + DINOv2 | é«˜ç»´è¯­ä¹‰ | å¤æ‚å¾®å¤šæ™®å‹’åœºæ™¯ |
| `vavae-imagenet256-f16d64-mae-50ep.ckpt` | f16d64 + MAE | é«˜ç»´é‡å»º | é«˜è´¨é‡æ—¶é¢‘å›¾ç”Ÿæˆ |

### LDMæ¨¡å‹ (349MB)
| æ¨¡å‹ | é…ç½® | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| `ldm-imagenet256-f16d16-50ep.ckpt` | f16d16 | è½»é‡çº§ | å¿«é€ŸåŸå‹éªŒè¯ |
| `ldm-imagenet256-f16d32-50ep.ckpt` | f16d32 | æ ‡å‡†ç‰ˆ | åŸºç¡€æ—¶é¢‘å›¾ç”Ÿæˆ |
| `ldm-imagenet256-f16d64-50ep.ckpt` | f16d64 | é«˜è´¨é‡ | ç²¾ç»†æ—¶é¢‘å›¾ç”Ÿæˆ |

## ğŸ¯ å¾®å¤šæ™®å‹’æ—¶é¢‘å›¾è®­ç»ƒå»ºè®®

### 1. æ•°æ®å‡†å¤‡
```python
# åˆ›å»ºè‡ªå®šä¹‰æ•°æ®åŠ è½½å™¨ (å‚è€ƒ ldm/data/imagenet.py)
class MicroDopplerDataset(Dataset):
    def __init__(self, data_root, size=256):
        self.data_root = data_root
        self.size = size
        # åŠ è½½æ—¶é¢‘å›¾æ–‡ä»¶åˆ—è¡¨
        
    def __getitem__(self, idx):
        # åŠ è½½æ—¶é¢‘å›¾ (.png/.jpg)
        # é¢„å¤„ç†ï¼šå½’ä¸€åŒ–åˆ°[-1, 1]
        # å¦‚æœæ˜¯ç°åº¦å›¾ï¼Œè½¬æ¢ä¸º3é€šé“æˆ–ä¿®æ”¹æ¨¡å‹é…ç½®
        pass
```

### 2. é…ç½®æ–‡ä»¶ä¿®æ”¹
```yaml
# åŸºäº f16d32_vfdinov2.yaml ä¿®æ”¹
model:
  params:
    embed_dim: 32  # æˆ–16/64
    use_vf: dinov2  # æ¨èç”¨äºå¾®å¤šæ™®å‹’
    ddconfig:
      in_channels: 1  # ç°åº¦æ—¶é¢‘å›¾
      out_ch: 1       # è¾“å‡ºä¹Ÿæ˜¯ç°åº¦
      resolution: 256 # æ—¶é¢‘å›¾åˆ†è¾¨ç‡

data:
  params:
    train:
      target: your.custom.MicroDopplerDataset
      params:
        data_root: /path/to/micro_doppler_data
```

### 3. è®­ç»ƒå‘½ä»¤
```bash
# ä»é¢„è®­ç»ƒæ¨¡å‹å¾®è°ƒ
bash LightningDiT/vavae/run_train.sh your_micro_doppler_config.yaml
```

### 4. æ¨èè®­ç»ƒç­–ç•¥

#### é˜¶æ®µ1ï¼šé¢„è®­ç»ƒæ¨¡å‹å¾®è°ƒ
- ä½¿ç”¨ `vavae-imagenet256-f16d32-dinov2-50ep.ckpt` ä½œä¸ºèµ·ç‚¹
- é…ç½® `weight_init` å‚æ•°
- è¾ƒå°å­¦ä¹ ç‡ (1e-5)

#### é˜¶æ®µ2ï¼šé¢†åŸŸé€‚é…
- é€æ­¥å¢åŠ å¾®å¤šæ™®å‹’æ•°æ®æ¯”ä¾‹
- è°ƒæ•´æŸå¤±æƒé‡
- ç›‘æ§é‡å»ºè´¨é‡

## ğŸ” å…³é”®æŠ€æœ¯ç‚¹

### 1. é€šé“æ•°é€‚é…
- **ç°åº¦æ—¶é¢‘å›¾**ï¼šä¿®æ”¹ `in_channels: 1, out_ch: 1`
- **ä¼ªå½©è‰²æ—¶é¢‘å›¾**ï¼šä¿æŒ `in_channels: 3, out_ch: 3`

### 2. è§†è§‰ç‰¹å¾é€‰æ‹©
- **DINOv2**ï¼šæ›´é€‚åˆå¾®å¤šæ™®å‹’çš„æ¨¡å¼è¯†åˆ«
- **MAE**ï¼šæ›´é€‚åˆæ—¶é¢‘å›¾çš„çº¹ç†é‡å»º

### 3. æŸå¤±å‡½æ•°è°ƒæ•´
- `vf_weight: 0.1`ï¼šè§†è§‰ç‰¹å¾å¯¹é½æƒé‡
- `kl_weight: 1e-6`ï¼šKLæ•£åº¦æƒé‡
- `disc_weight: 0.5`ï¼šåˆ¤åˆ«å™¨æƒé‡

### 4. è®­ç»ƒèµ„æº
- **å®˜æ–¹é…ç½®**ï¼š4x8 H800 GPUs
- **æœ€å°é…ç½®**ï¼š1x8 V100/A100 GPUs
- **batch_size**ï¼šæ ¹æ®GPUå†…å­˜è°ƒæ•´

## ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

1. **å‡†å¤‡å¾®å¤šæ™®å‹’æ•°æ®é›†**
2. **é€‰æ‹©åˆé€‚çš„é¢„è®­ç»ƒæ¨¡å‹** (æ¨èDINOv2å˜ä½“)
3. **ä¿®æ”¹é…ç½®æ–‡ä»¶** (é€šé“æ•°ã€æ•°æ®åŠ è½½å™¨)
4. **è®¾ç½®è®­ç»ƒç¯å¢ƒ** (Taming-Transformersç­‰)
5. **å¼€å§‹å¾®è°ƒè®­ç»ƒ**

è¿™æ ·å°±å¯ä»¥åŸºäºLightningDiTè®­ç»ƒä¸“é—¨çš„å¾®å¤šæ™®å‹’æ—¶é¢‘å›¾æ‰©æ•£æ¨¡å‹äº†ï¼
